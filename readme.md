# Twins
---
##  Что это? 
Twins - фреймворк для работы с графическими элементами для OpenComputers.

## Для чего подойдёт? 
С помощью фреймворка возможно создавать программы с графическим интерфейсом с минимальным вмешательством фреймворка в приложение (если программа написана в нормальном виде, подключение графического интерфейса не будет требовать переработки кода, а только дополнения). 

Фреймворк можно запустить на OpenOS-подобных системах со стандартным набором библиотек, однако, может быть портирована с помощью дополнительных модификаций. 

## Особенности:

- имеет "классовый" вид хранения элементов: доступные для работы элементы хранятся в виде экземпляров. При создании любого элемента на экране, он может быть загружен из экземпляра, а затем его свойства будут дополнены/переопределены из пользовательского кода.
- лёгкая для понимания система организации свойств элемента: все классы элементов построены по одному шаблону, имеют возможность изменения и добавления свойств уже созданных элементов "на лету". 
- встроенная оптимизация отрисовки: элементы, которые не были изменены, перерисовываться не будут (только для общей отрисовки). 
- событийная архитектура работы: весь функционал библиотеки во время работы (помимо инициализации) распределен на события, а значит, не требуется писать свои обработчики внутри программы. Основной поток выполнения можно занять другим кодом. 
- возможность использовать собственный цикл программы, помимо встроенного. 
- имеет встроенную систему позиционирования элементов на экране.
- изолированность: может быть запущен на любом контейнере, предоставляющим методы стандартной видеокарты (например, на контейнере с двойной буферизации для повышения производительности).

# С чего начать?
## Установка
Установить библиотеку можно с помощью следующей команды:

`
wget https://raw.githubusercontent.com/HiKT0/twins/main/install.lua /tmp/twins.lua -f && /tmp/twins.lua && del /tmp/twins.lua
`

Данная команда загрузит сгенерированный файл установщика с последней сборкой библиотеки в формате LuaSFS (serialized filesystem), затем распакует её и удалит себя. По завершении работы в системе будет доступна последняя версия Twins.
## Подключение
Библиотека, как и другие, подключается через `require`:

```lua
local twins = require("twins") --подключение
twins.base.button() --создание кнопки из стандартной коллекции элементов
twins.main() --запуск
```

В скрипте показан минимизированный цикл инициализации графического интерфейса.
## Свойства элемента
Элемент создаётся с набором свойств, указанных в его классе.  Однако, есть возможность указать свойства самостоятельно с помощью передачи таблицы в аргументы функции, с помощью которой осуществляется создание элемента:

```lua
twins.base.button({x=5, y=10, text="я кнопка"}) 
```

Из данной таблицы пары ключ-значение будут скопированы в новый созданный элемент. Таким образом создаётся свой "синтаксис", с помощью которого можно осуществлять разметку графического интерфейса. К тому же, есть возможность определить свойства элемента как и у любой таблицы:

```lua
local my_button = twins.base.button()
my_button.text = "я тоже"
```
# Система позиционирования
Базовая комплектация Twins включает в себя систему позиционирования элементов на экране и систему группового позиционирования элементов. Определять каждому элементу его координаты - ужасно, особенно если они вычисляются на ходу. Типовые операции по вычислению координат каждого элемента уже прописаны в системе. Write less, do more.
## Глобальное позиционирование
Модуль: `twins.sps` (от screen positioning system).
Позволяет вычислять координаты для элементов на экране, учитывая их размеры. 

Умеет:

- `twins.sps.left(element)` - прилипание элемента к левому краю
- `twins.sps.right(element)` - к правому краю
- `twins.sps.up(element)` - к верху
- `twins.sps.down(element)` - к низу
- `twins.sps.center(element)` - по центру экрана

Работа с массивами элементов:

- `twins.sps.left_list(elements_array)` - создание "колонки" элементов, которая прилипает к левому краю экрана
- `twins.sps.right_list(elements_array)` - к правому
- `twins.sps.center_list(elements_array)` - по центру

Функция для применения нескольких операций:

`twins.sps.position(position, element)`

Пример:

```lua
--[[
	В этом примере создается кнопка, затем функция глобального позиционирования
	выравнивает ее по центру и опускает вниз. После всех операций функции глобального
	позиционирования возвращают элемент или массив элементов, над которыми были проделаны операции.
]]
local centered_button_at_bottom = twins.sps.position("center down". twins.base.button())
```
## Групповое позиционирование
Групповое позиционирование создано для автоматического вычисления координат элементов внутри элемента `group` из стандартной коллекции элементов.

Пример (взята часть тестового скрипта):
```lua
local twins = require('twins')

twins.base.group({framed=true, gap=0, direction="v", items={
	twins.base.group({direction="h", items={
		twins.base.button({text="1"}),
		twins.base.button({text="2"}),
		twins.base.button({text="3"}),
	}}),
	twins.base.group({direction="h", items={
		twins.base.button({text="4"}),
		twins.base.button({text="5"}),
		twins.base.button({text="6"}),
	}}),
	twins.base.group({direction="h", items={
		twins.base.button({text="7"}),
		twins.base.button({text="8"}),
		twins.base.button({text="9"}),
	}}),
}})

twins.main()
```

В примере создается матрица 3х3 из пронумерованных кнопок.

Доступные свойства элемента группы:
`framed: boolean` - определяет, окружена ли группа рамкой
`gap: number` - определяет отступ между элементами в группе
`direction: string` - определяет направление размещения элементов в группе. 'h' или 'horizontal' - горизонтально; 'v' или 'vertical' - вертикально.
`items: table` - массив элементов, которые должны быть позиционированы внутри группы.

Группы поддерживают вложенность. В таком случае каждая вложенная группа рассматривается как единый элемент, а после его позиционирования позиционируются и все элементы внутри. Проще говоря, группы можно вкладывать друг в друга (как в примере).

Таким образом, группы выполняют функцию позиционирования и эстетическую функцию одновременно.

# Макросы
Код из примера в групповом позиционировании можно сократить:
```lua
local twins = require('twins')
twins.use_macros()

group{framed=true, gap=0, direction="v"} {
	group{} {
		button{text="1"},
		button{text="2"},
		button{text="3"},
	},
	group{} {
		button{text="4"},
		button{text="5"},
		button{text="6"},
	},
	group{} {
		button{text="7"},
		button{text="8"},
		button{text="9"},
	},
}

twins.main()
```

В этом примере используются макросы, добавленные в глобальную область переменной функцией `twins.use_macros(container: table)`. Эта функция добавляет в таблицу `container` функцию, с помощью которой можно организовывать красивый синтаксис разметки графической части программы, а также добавляет в ту же таблицу сокращения для базовых элементов: `button`, `text`, `input`. Таким образом можно писать более красивую разметку.

Если аргумент `container` не указан или не является таблицей, то макросы добавляются в глобальную область видимости. 